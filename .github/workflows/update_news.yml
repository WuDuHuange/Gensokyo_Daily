name: å¹»æƒ³ä¹¡æ—¥æŠ¥ - è‡ªåŠ¨æ›´æ–°

on:
  # æ¯ 6 å°æ—¶è¿è¡Œä¸€æ¬¡ï¼ˆæ”¹ä¸º 6 å°æ—¶å‘¨æœŸï¼Œè‹¥éœ€è¦æ”¹ä¸º 8 å°æ—¶è¯·å‘Šè¯‰æˆ‘ï¼‰
  schedule:
    - cron: '0 */6 * * *'
  # ä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
  # æ¨é€åˆ° main åˆ†æ”¯æ—¶ä¹Ÿè¿è¡Œä¸€æ¬¡
  push:
    branches: [main]
    paths:
      - 'fetch_news.py'

jobs:
  fetch-news:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»“åº“
        uses: actions/checkout@v4

      - name: ğŸ é…ç½® Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: pip install -r requirements.txt

      - name: ğŸ—ï¸ æŠ“å–æ–°é—»
        env:
          RSSHUB_BASE: ${{ secrets.RSSHUB_BASE || 'https://rsshub.app' }}
        run: python fetch_news.py

      - name: ğŸ“ æäº¤æ›´æ–°
        run: |
          git config --local user.email "aya@gensokyo.daily"
          git config --local user.name "å°„å‘½ä¸¸æ–‡ (Aya Shameimaru)"
          git add news_data.json
          # åªåœ¨æœ‰å˜åŒ–æ—¶æäº¤
          git diff --staged --quiet || git commit -m "ğŸ“° $(date -u +'%Y-%m-%d %H:%M UTC') æ—¥æŠ¥æ›´æ–°"
          git push
